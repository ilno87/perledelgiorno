<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Perla del Giorno</title>
  <style>
    html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; }
    .wrap { min-height: 100%; display: grid; place-items: center; padding: 24px; background: #0b1020; color: #f5f7ff; }
    .card { max-width: 780px; width: 100%; background: #141a32; padding: 28px; border-radius: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    h1 { margin: 0 0 8px; font-size: 1.6rem; font-weight: 700; }
    p#phrase { font-size: 1.6rem; line-height: 1.5; margin: 12px 0 0; white-space: pre-wrap; }
    .meta { opacity: .7; font-size: .9rem; margin-top: 14px; }
    .footer { margin-top: 22px; display: flex; gap: 8px; flex-wrap: wrap; }
    button, .chip { background: #1f2647; color: #dfe5ff; border: 1px solid #2b3363; padding: 8px 12px; border-radius: 12px; cursor: pointer; font-size: .95rem; }
    button:hover { filter: brightness(1.08); }
    .chip { cursor: default; }
    textarea { width: 100%; height: 160px; margin-top: 12px; display: none; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Perla del giorno ðŸ’Ž</h1>
      <div class="meta" id="date"></div>
      <p id="phrase">Caricamentoâ€¦</p>
      <div class="footer">
        <span class="chip" id="indexChip"></span>
        <button id="prev" title="Giorno precedente">â—€ï¸Ž</button>
        <button id="next" title="Giorno successivo">â–¶ï¸Ž</button>
        <button id="copy">Copia</button>
      </div>
      <textarea id="raw" aria-label="Modifica elenco frasi (una per riga)"></textarea>
    </div>
  </div>

  <script>
  // === CONFIGURA QUI ===
  const TIMEZONE = 'Europe/Rome'; // giorno calcolato su questo fuso
  const SEED = 'perle-v1';        // cambia se modifichi pesantemente l'elenco

  // Elenco frasi: una per riga. Puoi anche spostarlo in un file JSON se preferisci.
  const PHRASES = [
    'Il server Ã¨ lento perchÃ© Ã¨ pieno.',
    'Spegnilo e riaccendilo, fidati.',
    'Funzionava ieri, giuro.',
    'Ãˆ colpa della VPN.',
    'Prova a svuotare la cache del monitor.',
    'Se lo facciamo in produzione va meglio.',
    'Ho i permessi di admin? Chiedo a me stesso.',
    'Non Ã¨ un bug, Ã¨ una feature emergente.',
  ];

  // === UTIL ===
  function xmur3(str){ let h=1779033703^str.length; for(let i=0;i<str.length;i++){ h=Math.imul(h^str.charCodeAt(i),3432918353); h=h<<13|h>>>19; } return function(){ h=Math.imul(h^ (h>>>16),2246822507); h=Math.imul(h^ (h>>>13),3266489909); return (h^ (h>>>16))>>>0; } }
  function mulberry32(a){ return function(){ let t=a+=0x6D2B79F5; t=Math.imul(t^ (t>>>15),1|t); t^=t+Math.imul(t^ (t>>>7),61|t); return ((t^ (t>>>14))>>>0)/4294967296; } }
  function seededShuffle(arr, seedStr){ const seed = xmur3(seedStr)(); const rand = mulberry32(seed); const a = arr.slice(); for (let i=a.length-1; i>0; i--){ const j = Math.floor(rand()*(i+1)); [a[i], a[j]]=[a[j], a[i]]; } return a; }

  function nowInTZ(tz){ return new Date(new Date().toLocaleString('en-GB', { timeZone: tz })); }
  function startOfDayTZ(d, tz){ const parts = new Intl.DateTimeFormat('en-CA',{ timeZone: tz, year:'numeric', month:'2-digit', day:'2-digit'}).formatToParts(d);
    const y=+parts.find(p=>p.type==='year').value; const m=+parts.find(p=>p.type==='month').value; const day=+parts.find(p=>p.type==='day').value; return new Date(Date.UTC(y, m-1, day)); }
  function daysSinceEpochTZ(d, tz){ const sod = startOfDayTZ(d, tz); return Math.floor(sod.getTime()/86400000); }

  function phraseOfTheDay(list, seed, date){ if(!list.length) return 'â€” (nessuna frase) â€”'; const perm = seededShuffle(list.map((_,i)=>i), seed); const idx = daysSinceEpochTZ(date, TIMEZONE) % list.length; return { indexInCycle: idx, total: list.length, pos: perm[idx], text: list[perm[idx]] } }

  // === UI ===
  const elDate = document.getElementById('date');
  const elPhrase = document.getElementById('phrase');
  const elIndex = document.getElementById('indexChip');
  const btnPrev = document.getElementById('prev');
  const btnNext = document.getElementById('next');
  const btnCopy = document.getElementById('copy');
  const elRaw = document.getElementById('raw');

  let offsetDays = 0; // per i bottoni prev/next

  function render(){
    const now = nowInTZ(TIMEZONE);
    const viewDate = new Date(now.getTime() + offsetDays*86400000);
    const f = phraseOfTheDay(PHRASES, SEED, viewDate);
    const fmt = new Intl.DateTimeFormat('it-IT', { timeZone: TIMEZONE, weekday:'long', year:'numeric', month:'long', day:'numeric' });
    elDate.textContent = fmt.format(viewDate);
    elPhrase.textContent = f.text;
    elIndex.textContent = `Giorno ${f.indexInCycle+1} di ${f.total}`;
  }

  btnPrev.addEventListener('click', ()=>{ offsetDays--; render(); });
  btnNext.addEventListener('click', ()=>{ offsetDays++; render(); });
  btnCopy.addEventListener('click', async ()=>{
    try { await navigator.clipboard.writeText(elPhrase.textContent); btnCopy.textContent='Copiato!'; setTimeout(()=>btnCopy.textContent='Copia', 1200); } catch(e){ alert('Impossibile copiare: '+e); }
  });

  // Supporto querystring ?d=YYYY-MM-DD per puntare un giorno specifico
  (function(){
    const u = new URL(location.href);
    const d = u.searchParams.get('d');
    if(d){ const parts = d.split('-').map(Number); if(parts.length===3){ const target = new Date(Date.UTC(parts[0], parts[1]-1, parts[2]));
      const today = startOfDayTZ(nowInTZ(TIMEZONE), TIMEZONE);
      offsetDays = Math.round((target - today)/86400000);
    }}
  })();

  render();
  </script>
</body>
</html>
